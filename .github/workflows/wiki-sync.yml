name: Sync Wiki

on:
  push:
    branches:
      - main
    paths:
      - 'TECHNICAL_DOCS.md'
      - 'USER_GUIDE.md'
      - '.github/workflows/wiki-sync.yml'

jobs:
  sync-wiki:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Prepare Wiki Content
        run: |
          mkdir -p wiki_content
          cp TECHNICAL_DOCS.md wiki_content/Technical-Documentation.md
          cp USER_GUIDE.md wiki_content/User-Guide.md
          [ -f SECURITY.md ] && cp SECURITY.md wiki_content/Security.md || true
          [ -f CONTRIBUTING.md ] && cp CONTRIBUTING.md wiki_content/Contributing.md || true
          
          # Create Home.md if it doesn't exist
          cat > wiki_content/Home.md << 'EOF'
          # ClickUp Gmail Chrome Extension Wiki

          Welcome! This wiki contains documentation for the ClickUp Gmail Chrome Extension.

          ## ðŸ“š Pages

          - [[User Guide]] - Installation and feature usage
          - [[Technical Documentation]] - Architecture, security, and API details
          - [[Contributing]] - How to contribute
          - [[Security]] - Security policy and reporting

          ## ðŸ”— Quick Links

          - [GitHub Repository](https://github.com/Diramain/clickup-gmail-chrome)
          - [Releases](https://github.com/Diramain/clickup-gmail-chrome/releases)
          - [Issues](https://github.com/Diramain/clickup-gmail-chrome/issues)
          EOF

      - name: Sync Documents to Wiki
        uses: Andrew-Chen-Wang/github-wiki-action@v4
        with:
          path: wiki_content
