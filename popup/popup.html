<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClickUp Gmail Tracker</title>
    <link rel="stylesheet" href="popup.css">
</head>

<body>
    <div class="popup-container">
        <header class="popup-header">
            <div class="logo">
                <svg width="32" height="32" viewBox="0 0 180 180" fill="url(#gradient)">
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#49CCF9" />
                            <stop offset="50%" style="stop-color:#8930FD" />
                            <stop offset="100%" style="stop-color:#FF02F0" />
                        </linearGradient>
                    </defs>
                    <path
                        d="M25.4 129.1L49.2 110.9C61.9 127.4 75.3 135 90.3 135C105.1 135 118.2 127.5 130.3 111.1L154.4 128.9C137 152.5 115.3 165 90.3 165C65.3 165 43.4 152.6 25.4 129.1Z" />
                    <polygon points="90.2 49.8 47.8 86.4 28.2 63.6 90.3 10.2 151.8 63.7 132.2 86.3" />
                </svg>
                <h1>ClickUp Gmail</h1>
            </div>
        </header>

        <!-- Loading State -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Loading...</p>
        </div>

        <!-- Login Required (same as before) -->
        <div id="login-required" class="section hidden">
            <div class="card">
                <h2>OAuth Configuration</h2>
                <p class="help-text">Create a ClickUp OAuth App to connect:</p>

                <!-- Step 1: Redirect URL -->
                <div class="step-card">
                    <span class="step-number">1</span>
                    <div class="step-content">
                        <p>Copy this <strong>Redirect URL</strong>:</p>
                        <div class="url-box">
                            <input type="text" id="redirectUrl" readonly>
                            <button id="copyUrl" class="btn-icon" title="Copy URL">üìã</button>
                        </div>
                        <p class="hint">Click the üìã button to copy</p>
                    </div>
                </div>

                <!-- Step 2: Create App -->
                <div class="step-card">
                    <span class="step-number">2</span>
                    <div class="step-content">
                        <p>Go to <a href="https://app.clickup.com/settings/integrations" target="_blank">ClickUp
                                Integrations</a></p>
                        <p class="hint">Click "Create an App" and paste the Redirect URL</p>
                    </div>
                </div>

                <!-- Step 3: Enter credentials -->
                <div class="step-card">
                    <span class="step-number">3</span>
                    <div class="step-content">
                        <p>Enter your credentials below:</p>
                    </div>
                </div>

                <div class="form-group">
                    <label for="clientId">Client ID</label>
                    <input type="text" id="clientId" placeholder="Enter Client ID">
                </div>

                <div class="form-group">
                    <label for="clientSecret">Client Secret</label>
                    <input type="password" id="clientSecret" placeholder="Enter Client Secret">
                </div>

                <button id="saveConfig" class="btn btn-secondary">Save Configuration</button>
            </div>

            <button id="signIn" class="btn btn-primary" disabled>
                Sign in with ClickUp
            </button>

            <button id="openWindow" class="btn btn-link">
                üìê Open in separate window (recommended)
            </button>
        </div>

        <!-- Logged In - Tabbed Interface -->
        <div id="logged-in" class="section hidden">
            <!-- Tab Navigation - Tracking is default (first active) -->
            <nav class="tab-nav">
                <button class="tab-btn" data-tab="tasks">
                    <span class="tab-icon">üìã</span>
                    <span class="tab-label">Tasks</span>
                </button>
                <button class="tab-btn active" data-tab="tracking">
                    <span class="tab-icon">‚è±Ô∏è</span>
                    <span class="tab-label">Tracking</span>
                </button>
                <button class="tab-btn" data-tab="config">
                    <span class="tab-icon">‚öôÔ∏è</span>
                    <span class="tab-label">Config</span>
                </button>
            </nav>

            <!-- ========================================== -->
            <!-- TAB A: Tasks -->
            <!-- ========================================== -->
            <section id="tab-tasks" class="tab-content hidden">
                <!-- Search Task -->
                <div class="card">
                    <h3>üîç Search Task</h3>
                    <input type="text" id="taskSearch" placeholder="Search by title or task ID...">
                    <div id="searchResults" class="search-results"></div>
                </div>

                <!-- Create Task - Two buttons -->
                <div class="card">
                    <h3>‚ûï Create Task</h3>
                    <div class="create-task-buttons">
                        <button id="quickCreateTask" class="btn btn-primary">
                            ‚ö° Quick Create
                        </button>
                        <button id="openTaskModal" class="btn btn-secondary">
                            üìù Full Form
                        </button>
                    </div>
                    <p class="hint text-center mt-8">Quick: inline form / Full: popup like Gmail</p>
                </div>

                <!-- Quick Create Form (toggleable) -->
                <div id="quickCreateForm" class="card hidden">
                    <h3>‚ö° Quick Create</h3>
                    <div class="form-group">
                        <input type="text" id="newTaskName" placeholder="Task name...">
                    </div>
                    <div class="form-group">
                        <textarea id="newTaskDescription" placeholder="Description (optional)..." rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <input type="text" id="listSearch" placeholder="Search destination list...">
                        <div id="listSearchResults" class="search-results"></div>
                    </div>
                    <div class="btn-row">
                        <button id="cancelQuickCreate" class="btn btn-link">Cancel</button>
                        <button id="createTask" class="btn btn-primary" disabled>Create Task</button>
                    </div>
                </div>
            </section>

            <!-- ========================================== -->
            <!-- TAB B: Time Tracking (DEFAULT) -->
            <!-- ========================================== -->
            <section id="tab-tracking" class="tab-content active">
                <!-- Running Timer -->
                <div class="card timer-card">
                    <div id="runningTimer" class="running-timer hidden">
                        <p class="timer-task-name" id="timerTaskName">Task Name</p>
                        <p class="timer-display" id="timerDisplay">00:00:00</p>
                        <div class="timer-controls">
                            <button id="stopTimer" class="btn btn-danger">‚èπÔ∏è Stop</button>
                        </div>
                    </div>
                    <div id="noTimer" class="no-timer">
                        <p class="timer-display dim">00:00:00</p>
                        <p class="hint">No timer running</p>
                    </div>
                </div>

                <!-- Auto Tracking Toggles -->
                <div class="card">
                    <h3>ü§ñ Auto Tracking</h3>
                    <p class="hint mb-8">Settings saved for future ClickUp.com integration</p>
                    <div class="toggle-row">
                        <span class="toggle-label">Auto-start when opening task</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoStartToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-row">
                        <span class="toggle-label">Auto-stop when closing task</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoStopToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Start Timer on Task -->
                <div class="card">
                    <h3>‚ñ∂Ô∏è Start Timer</h3>
                    <input type="text" id="trackTaskSearch" placeholder="Search task to track...">
                    <div id="trackSearchResults" class="search-results"></div>
                    <button id="startTimerBtn" class="btn btn-primary" disabled>‚ñ∂Ô∏è Start Timer</button>
                </div>

                <!-- Manual Time Entry -->
                <div class="card">
                    <h3>‚úçÔ∏è Manual Entry</h3>
                    <div class="form-group">
                        <input type="text" id="manualTaskSearch" placeholder="Search task...">
                        <div id="manualSearchResults" class="search-results"></div>
                    </div>
                    <div class="form-group">
                        <label>Duration <span class="hint">(e.g. 1h, 30m, 1:30, 1h30m)</span></label>
                        <input type="text" id="durationInput" placeholder="e.g. 1h 30m or 1:30">
                    </div>
                    <button id="addManualTime" class="btn btn-secondary" disabled>Add Time Entry</button>
                </div>

                <!-- Time History -->
                <div class="card">
                    <h3>üìä Recent Entries</h3>
                    <div id="timeHistory" class="time-history">
                        <p class="hint">Loading entries...</p>
                    </div>
                </div>
            </section>

            <!-- ========================================== -->
            <!-- TAB C: Configuration -->
            <!-- ========================================== -->
            <section id="tab-config" class="tab-content hidden">
                <!-- User Info -->
                <div class="user-info">
                    <img id="userAvatar" src="" alt="Avatar" class="avatar">
                    <div class="user-details">
                        <span id="userName" class="user-name">User Name</span>
                        <span id="userEmail" class="user-email">email@example.com</span>
                    </div>
                </div>

                <!-- Preferred Workspace -->
                <div class="card">
                    <h3>üè¢ Preferred Workspace</h3>
                    <p class="help-text">Select your preferred workspace for default actions:</p>
                    <select id="teamSelect" class="select">
                        <option value="">Select Workspace...</option>
                    </select>
                </div>
                <!-- Custom Field Settings -->
                <div class="card">
                    <h3>üè∑Ô∏è Custom Field</h3>
                    <div class="toggle-row mb-4">
                        <span class="toggle-label">Use Custom Field Storage</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="useCustomFieldToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <p class="help-text">Name of the Text Custom Field to store Email Thread IDs:</p>
                    <div class="form-group">
                        <input type="text" id="customFieldName" placeholder="Default: Gmail Thread ID">
                    </div>
                    <button id="saveCustomFieldConfig" class="btn btn-secondary btn-small">Save Field Name</button>
                    <p class="hint mt-4">If disabled, Thread ID will be saved in the task description.</p>
                </div>

                <!-- Sync Cards -->
                <div class="card sync-card">
                    <h3>üì¶ List Cache</h3>
                    <p class="help-text" id="syncStatus">Pre-load lists for faster task creation</p>
                    <button id="syncLists" class="btn btn-primary">
                        <span class="btn-text">üîÑ Sync Lists</span>
                        <span class="spinner hidden"></span>
                    </button>
                </div>

                <div class="card sync-card">
                    <h3>üìß Email Tasks</h3>
                    <p class="help-text" id="emailSyncStatus">Sync tasks linked to emails</p>
                    <div class="sync-options">
                        <select id="emailSyncDays" class="select-inline">
                            <option value="30">Last 30 days</option>
                            <option value="60">Last 60 days</option>
                            <option value="90">Last 90 days</option>
                        </select>
                        <button id="syncEmailTasks" class="btn btn-primary btn-small">
                            <span class="btn-text">üîÑ Sync</span>
                            <span class="spinner hidden"></span>
                        </button>
                    </div>
                </div>

                <!-- Feedback -->
                <div class="card">
                    <h3>üí¨ Feedback</h3>
                    <div class="form-group">
                        <textarea id="feedbackText" placeholder="Your feedback or suggestions..." rows="3"></textarea>
                    </div>
                    <button id="sendFeedback" class="btn btn-secondary">Send Feedback</button>
                    <a href="https://github.com/diramain/clickup-gmail-chrome" target="_blank" class="btn btn-link">
                        ‚≠ê View on GitHub
                    </a>
                </div>

                <!-- Dev Tools -->
                <div class="card dev-tools">
                    <h3>üîß Dev Tools</h3>
                    <button id="testTokenRefresh" class="btn btn-warning">üß™ Test Token Refresh</button>
                    <p class="hint" id="testResult"></p>
                </div>

                <!-- DBA-H1 & DM-H1: Data Management -->
                <div class="card">
                    <h3>üíæ Data Management</h3>
                    <p class="help-text">Export your email-task mappings or clear stored data</p>
                    <div class="btn-row mt-8">
                        <button id="exportData" class="btn btn-secondary btn-small">üì• Export Data</button>
                        <button id="clearData" class="btn btn-danger btn-small">üóëÔ∏è Clear Data</button>
                    </div>
                    <p class="hint mt-8" id="dataStatus"></p>
                </div>

                <button id="signOut" class="btn btn-danger">Sign Out</button>
            </section>
        </div>

        <footer class="popup-footer">
            <p>Built by <strong>Leandro Iramain</strong> with ‚ù§Ô∏è and AI</p>
        </footer>
    </div>
    <script src="popup.js"></script>
</body>

</html>